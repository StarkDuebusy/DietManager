extends sidebarlayout

block content
  .col-12.col-md-8.col-lg-9.col-xl-10.pl-lg-4
    .row
      .col-12.col-lg-12.d-flex
        .card.flex-fill.w-100
          .card-header
            .row
              .col-md-6
                h5.card-title.mb-0.mt-2 몸무게 변화
          .card-body
            ul.pagination.pagination-lg.justify-content-center
              li.page-item
                #btnPrevMonth.page-link
                  i.fas.fa-angle-left
              li.page-item
                string#txtMonth.page-link 1월
              li.page-item
                #btnNextMonth.page-link
                  i.fas.fa-angle-right
            .chart.chart-lg.mt-2
              canvas#chartWeight
        script.
          var chartWeight;
          document.addEventListener("DOMContentLoaded", function(event) {
            chartWeight = new Chart(document.getElementById("chartWeight"), {
              type: 'line',
              data: {
                labels: ["1일"],
                datasets: [{
                  label: "몸무게",
                  fill: false,
                  backgroundColor: "rgba(65, 212, 146, 0.5)",
                  borderColor: "#41D492",
                  data: [0]
                }]
              },
              options: {
                maintainAspectRatio: false,
                legend: {
                  display: true
                },
                tooltips: {
                  intersect: false,
                  callbacks: {
                    label: function(tooltipItem, data) {
                        var label = data.datasets[tooltipItem.datasetIndex].label || '';

                        if (label) {
                            label += ' : ';
                        }
                        label += Math.round(tooltipItem.yLabel * 100) / 100;
                        label += 'KG';
                        return label;
                    }
                  }
                },
                hover: {
                  intersect: true
                },
                plugins: {
                  filler: {
                    propagate: false
                  }
                },
                elements: {
                  line: {
                    tension: 0
                  }
                },
                scales: {
                  xAxes: [{
                    reverse: true,
                    gridLines: {
                      color: "rgba(0,0,0,0.0)"
                    }
                  }],
                  yAxes: [{
                    ticks: {
                      stepSize: 5
                    },
                    display: true,
                    borderDash: [5, 5],
                    gridLines: {
                      color: "rgba(0,0,0,0)",
                      fontColor: "#fff"
                    }
                  }]
                }
              }
            });
          });
    .row
      .col-12.col-lg-12.d-flex
        .card.flex-fill.w-100
          .card-header
            .row
              .col-md-6
                h5.card-title.mb-0.mt-2 체성분 변화
              .col-md-6.text-right
                button.btn.btn-primary 체성분 기록
          .card-body
            ul.pagination.pagination-lg.justify-content-center
              li.page-item
                #btnPrevMonth.page-link
                  i.fas.fa-angle-left
              li.page-item
                string.page-link 2019년
              li.page-item
                #btnNextMonth.page-link
                  i.fas.fa-angle-right
            .chart.chart-lg.mt-2
              canvas#chartBodycompotision
        script.
          document.addEventListener("DOMContentLoaded", function(event) {
            new Chart(document.getElementById("chartBodycompotision"), {
              type: 'line',
              data: {
                labels: ["1월", "2월",  "3월",  "4월", "5월",  "6월",  "7월", "8월",  "9월",  "10월",  "11월",  "12월"],
                datasets: [{
                  label: "몸무게",
                  fill: false,
                  backgroundColor: "rgba(65, 212, 146, 0.5)",
                  borderColor: "#41D492",
                  data: [6, 7, 8, 11, 9, 11, 8, 14, 12, 16, 9, 10]
                }, {
                  label: "골격근량",
                  fill: false,
                  backgroundColor: "rgba(242, 102, 102, 0.5)",
                  borderColor: "#f26666",
                  data: [14, 15, 9, 12, 16, 17, 22, 18, 24, 32, 31, 36]
                }, {
                  label: "체지방량",
                  fill: false,
                  backgroundColor: "rgba(168, 119, 181, 0.5)",
                  borderColor: "#a877b5",
                  data: [3, 5, 4, 9, 5, 8, 5, 6, 4, 7, 4, 3]
                }]
              },
              options: {
                maintainAspectRatio: false,
                legend: {
                  display: true
                },
                tooltips: {
                  intersect: false,
                  callbacks: {
                    label: function(tooltipItem, data) {
                        var label = data.datasets[tooltipItem.datasetIndex].label || '';

                        if (label) {
                            label += ' : ';
                        }
                        label += Math.round(tooltipItem.yLabel * 100) / 100;
                        label += 'KG';
                        return label;
                    }
                  }
                },
                hover: {
                  intersect: true
                },
                plugins: {
                  filler: {
                    propagate: false
                  }
                },
                elements: {
                  line: {
                    tension: 0
                  }
                },
                scales: {
                  xAxes: [{
                    reverse: true,
                    gridLines: {
                      color: "rgba(0,0,0,0.0)"
                    }
                  }],
                  yAxes: [{
                    ticks: {
                      stepSize: 5
                    },
                    display: true,
                    borderDash: [5, 5],
                    gridLines: {
                      color: "rgba(0,0,0,0)",
                      fontColor: "#fff"
                    }
                  }]
                }
              }
            });
          });
    .row
      .col-12.col-lg-12.d-flex
        .card.flex-fill.w-100
          .card-header
            .row
              .col-md-6
                h5.card-title.mb-0.mt-2 FFMI(Fat Free Mas Index)
              .col-md-6.text-right
                |FFMI : 
                span.text-primary 평균이상
          .card-body
            ul.pagination.pagination-lg.justify-content-center
              li.page-item
                #btnPrevMonth.page-link
                  i.fas.fa-angle-left
              li.page-item
                string.page-link 2019년
              li.page-item
                #btnNextMonth.page-link
                  i.fas.fa-angle-right
            .chart.chart-lg.mt-2
              canvas#chartFFMI
        script.
          document.addEventListener("DOMContentLoaded", function(event) {
            new Chart(document.getElementById("chartFFMI"), {
              type: 'line',
              data: {
                labels: ["1월", "2월",  "3월",  "4월", "5월",  "6월",  "7월", "8월",  "9월",  "10월",  "11월",  "12월"],
                datasets: [{
                  label: "FFMI",
                  fill: false,
                  backgroundColor: "rgba(65, 212, 146, 0.5)",
                  borderColor: "#41D492",
                  data: [6, 7, 8, 11, 9, 11, 8, 14, 12, 16, 9, 10]
                }]
              },
              options: {
                maintainAspectRatio: false,
                legend: {
                  display: true
                },
                tooltips: {
                  intersect: false,
                  callbacks: {
                    label: function(tooltipItem, data) {
                        var label = data.datasets[tooltipItem.datasetIndex].label || '';

                        if (label) {
                            label += ' : ';
                        }
                        label += Math.round(tooltipItem.yLabel * 100) / 100;
                        return label;
                    }
                  }
                },
                hover: {
                  intersect: true
                },
                plugins: {
                  filler: {
                    propagate: false
                  }
                },
                elements: {
                  line: {
                    tension: 0
                  }
                },
                scales: {
                  xAxes: [{
                    reverse: true,
                    gridLines: {
                      color: "rgba(0,0,0,0.0)"
                    }
                  }],
                  yAxes: [{
                    ticks: {
                      stepSize: 5
                    },
                    display: true,
                    borderDash: [5, 5],
                    gridLines: {
                      color: "rgba(0,0,0,0)",
                      fontColor: "#fff"
                    }
                  }]
                }
              }
            });
          });
block script
  script.
    $(document).ready(init);

    function init(){
      var d = new Date();
      var month = d.getMonth()+1
      $('#txtMonth').text(month+'월');
      ajaxGetWeightList(month);

      $('#btnNextMonth').on('click', function(){
        var txtMonth = $(this).parents('ul').find('#txtMonth');
        var month = parseInt(txtMonth.text());
        if(month == 12){
          month = 1;
        }else{
          month++;
        }
        txtMonth.text(month+'월');
        ajaxGetWeightList(month);
      });

      $('#btnPrevMonth').on('click', function(){
        var txtMonth = $(this).parents('ul').find('#txtMonth');
        var month = parseInt(txtMonth.text());
        if(month == 1){
          month = 12;
        }else{
          month--;
        }
        txtMonth.text(month+'월');
        ajaxGetWeightList(month);
      });
    }

    function afterLogin(){
      window.location.href = getUrl('/view/dashboard/');
    }

    function renderChartWeight(month, weightList){
      var date = new Date(), y = date.getFullYear();
      var lastDay = new Date(y, month, 0);
      lastDay = lastDay.getDate();

      chartWeight.config.data.labels = [];
      chartWeight.config.data.datasets[0].data = [];
      for(var day = 1; day <= lastDay; day++){
        chartWeight.config.data.labels.push(day+'일');
        if(weightList == undefined){
          chartWeight.config.data.datasets[0].data.push(0);
        }else{
          chartWeight.config.data.datasets[0].data.push(weightList[day-1]);
        }
      }
      
      chartWeight.update();
    }

    function ajaxGetWeightList(month){
      var params = {
        year : new Date().getFullYear(),
        month : month
      };

      var strURL = getUrl('/api/dashboard/weight');
      $.ajax({ 
        type: 'GET', 
        url: strURL,
        async: false, 
        data: params
      }).done(function(resultParams){
        var message = "운동 목표가 정상적으로 등록되었습니다.";
        var title = "운동 목표 설정";
        var type = "success";

        if(resultParams.isSuccess){
          renderChartWeight(month, resultParams.weightList);
        }else if(resultParams.needLogin){
          renderChartWeight(month);
        }else{
          type = "warning";
          message = "운동 목표 등록을 실패했습니다.";
          showMessage(message, title, type);
        }
      }).fail(function(resultParams){
        var message = "서버가 혼잡하오니 잠시 다시 이용 부탁드립니다.";
        var title = "서비스점검중";
        var type = "error";
        showMessage(message, title, type);
      });
    }

    function getUrl(targetURL){
      var strURL = '';
      if(window.location.pathname.split('/').length > 1 && window.location.pathname.split('/')[1].length == 2){
        strURL = '/'+window.location.pathname.split('/')[1]+targetURL; 
      }else{
        strURL = '/kr'+targetURL; 
      }
      return strURL;
    }

    function showMessage(message, title, type){
      toastr[type](message, title, {
              positionClass: "toast-top-right",
              closeButton: true,
              progressBar: true,
              newestOnTop: true,
              rtl: false,
              timeOut: 5000
              });
    }